<html>
  <head>
    <title>scrounge</title>
    <script src="jquery/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="scroungelib.js" type="text/javascript"></script>
    <script type = "text/javascript" language = "javascript">
      var logger = {
        log: function () {
          var args = Array.prototype.slice.call(arguments)
          console.log.apply(console.log, args);
          $("#log").append(args.join(" "), "\n");
        }
      };
      $(document).ready(() => {
        $("#indexButton").click(() => {
          window.Scrounger.index(getInterface(), logger);
         });
      });
      function getInterface () {
        var _resourceText = {  };
        var _log = function () {
          var args = [].slice.call(arguments);
          $("#log").append(args.map(elt => {
            return elt.toString.apply(elt);
          }).join(" ") + "\n");
          console.log.apply(console, args);
        };
        var _queue = Scrounger.makeQueue(() => {
          $("#results").append(JSON.stringify(_resourceText, null, 2));
        });
      
        return {
          resourceText: _resourceText,
          log: _log,
          get: function (url, f) {
            _queue.add(url);
            var elt = $("\x3cdiv/\x3e");
            return elt.load(url, function (data, status, jqXhr) {
              // would like to return a simple HTML object.
              function find () {
                return elt.find.apply(elt, [].slice.call(arguments));
              }
              function absolutize (rel) {
                d = document.implementation.createHTMLDocument();
                b = d.createElement('base');
                d.head.appendChild(b);
                a = d.createElement('a');
                d.body.appendChild(a);
                b.href = url;
                a.href = rel;
                return a.href;
              }
              f(jqXhr.status, find, absolutize, url, _resourceText);
              _queue.finished(url);
            });
          }
        };
      }
    </script>
    <style type="text/css">
      #log { background-color:#cc0; }
    </style>
  </head>
  <body>
      <input type="button" id="indexButton" value="Index" />
      <pre id="log"></pre>
      <pre id="results"></pre>
  </body>
</html>

